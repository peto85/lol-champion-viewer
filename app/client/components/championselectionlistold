import React from 'react';
import $ from 'jquery';
import Promise from 'bluebird';
import Masonry from 'react-masonry-component';

import CSSModules from 'react-css-modules';
import styles from './styles.css';

import ChampionSelectionButton from '../ChampionSelectionButton/ChampionSelectionButton.jsx';


class ChampionSelectionList extends React.Component {

  constructor(props) {
    super(props);

    // empty state
    this.state = {
      loading: true,
      allChampionList : [],
      currentChampionList : []
    }
  }

  getChampionList() {
    return Promise.resolve($.getJSON('http://localhost:3000/api/champion'));
  }

  gotChampionList = (data) => {
    console.log('SUCCESS when retrieving list of champions from server');
    this.setState({
      loading: false,
      allChampionList: data,
      currentChampionList: data
    });
  }

  handleError = ( errorData ) => {
    console.log('ERROR when retrieving list of champions from server');
    this.setState({
      allChampionList: [],
      currentChampionList: []
    });
  }

  componentDidMount() {
    this.getChampionList()
      .then(this.gotChampionList);
  }

  onClickHandler() {
    console.log('Element clicked');
  }

  render() {
    if (this.state.loading) {
      return (
      <div className='col-xs-6'>
        <h2 clasName='text-center'>Champion List</h2>
        <p>LOADING...</p>
      </div>
      )
    } else {
      let listItems = this.state.currentChampionList.map(
        (champion, i) => {
          return (
            <ChampionSelectionButton className='grid-item' key={i} championData={champion} onClick={this.onClickHandler}/>
          );
        }
      );

      var masonryOptions = {
        transitionDuration: '0.1s',
        columnWidth: 120,
        gutter: 10,
        fitWidth: true
      };

      return (
        <div className='col-xs-6'>
          <h2 clasName='text-center'>Champion List</h2>
            <Masonry
                 className={'grid'}
                 styleName={'listContainer'}
                 elementType={'div'}
                 options={masonryOptions}
                 disableImagesLoaded={false}
             >
                 {listItems}
             </Masonry>
        </div>
      )
    }


  }

}
export default CSSModules(ChampionSelectionList, styles);
